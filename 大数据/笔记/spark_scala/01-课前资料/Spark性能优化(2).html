<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/276742; Windows/10.0.10586 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5256"/>

<div><span><br/><div style="font-size: 16px"><div style="outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><div style="outline:0px;font-size:13px;text-align:left;vertical-align:baseline;background:50% 0% no-repeat fixed rgb(230, 235, 234);line-height:1;word-wrap:break-word;color:rgb(85, 85, 85);font-family:Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;"><div style="outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><div style="outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;zoom:1;line-height:1.4em;"><div style="outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.247059) 0px 1px 3px;background-color:rgb(255, 255, 255);zoom:1;"><div>

<h2 style="text-align:left;margin:0px;border:0px;outline:0px;font-size:20px;padding:0px;vertical-align:baseline;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;line-height:60px;"><a href="http://blog.cheyo.net/104.html" style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 91, 31);text-decoration:none;">Spark性能优化(2)——广播变量、本地缓存目录、RDD操作、数据倾斜</a><small style="margin:0px;padding:0px;border:0px;outline:0px;text-align:left;vertical-align:baseline;background:transparent;font-size:16px;color:rgb(206, 209, 209);float:right;">2015-06-24 21:00</small></h2>

<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">广播变量</h3>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">背景</h4>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">一般Task大小超过10K时（Spark官方建议是20K），需要考虑使用广播变量进行优化。<br/>
大表小表Join，小表使用广播的方式，减少Join操作。    </p>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">参考：<a href="http://blog.cheyo.net/56.html" style="vertical-align:baseline;margin:0px;border:0px;outline:0px;font-size:100%;text-align:left;padding:0px;background:transparent;color:rgb(249, 91, 31);text-decoration:none;border-bottom-width:1px;border-bottom-style:dashed;border-bottom-color:rgb(206, 209, 209);">Spark广播变量与累加器</a></p>

<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">Local Dir</h3>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">背景</h4>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">shuffle过程中，临时数据需要写入本地磁盘。本地磁盘的临时目录通过参数spark.local.dir配置。</p>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">性能优化点</h4>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">spark.local.dir支持配置多个目录。配置spark.local.dir有多个目录，每个目录对应不同的磁盘，这样可以提升IO效率。另外，可以采用IO性能较高的磁盘作为local dir的磁盘。</p>

<blockquote style="vertical-align:baseline;margin:0px 0px 15px;border:0px;outline:0px;font-size:100%;text-align:left;padding:0px 0px 0px 14px;background:transparent;quotes:none;border-left-width:5px;border-left-style:solid;border-left-color:rgb(238, 238, 238);"><span style="font-size:100%;text-align:left;quotes:none;"></span>
<p style="vertical-align:baseline;margin:0px 0px 14px;border:0px;outline:0px;background:transparent;text-align:left;padding:0px;font-size:14px;line-height:34px;color:rgb(119, 119, 119);margin-bottom:0px;font-weight:300;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">注意：</p>

<ul style="margin:0px 0px 10px 25px;padding:0px;border:0px;outline:0px;font-size:14px;text-align:left;vertical-align:baseline;background:transparent;list-style:disc;">
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">如果使用YARN、Mesos等资源框架，此参数应该通过相应资源框架的参数来设置。</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">如果只有一个磁盘，配置了多个目录，性能提升不大。</li>
</ul>
<span style="font-size:100%;text-align:left;quotes:none;"></span></blockquote>

<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">RDD操作:使用MapPartitions替代Map</h3>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">性能优化点</h4>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">map方法是对RDD的每一条记录逐一操作。mapPartitons是对整个RDD，以迭代器的方式逐一操作。比如对条记录的开销较大，比如需要连接、断开数据库。使用map方法需要对每一条记录都连接、断开数据库，效率差。此时，可以改用mapPartitons操作，只需要整个Partition连接、断开一次数据库即可。</p>
<div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><table style="outline:0px;font-size:100%;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;border:0px;font-weight:inherit;text-align:left;vertical-align:baseline;background:transparent;border-collapse:collapse;border-spacing:0px;width:100%;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><td style="text-align:left;margin:0px;border:0px;outline:0px;font-size:100%;padding:0px;vertical-align:baseline;background:transparent;overflow:auto;width:35px;border-right-width:0px;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="font-family:Monaco, Menlo, 'Courier New', monospace;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;background-color:rgb(57, 57, 57);vertical-align:baseline;background:transparent;padding:8px;display:block;line-height:20px;overflow:auto;border-radius:0.71em 0px 0px 0.71em;color:rgb(190, 190, 197);text-align:right;border-right-style:none;">1</pre></div></td><td style="margin:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;padding:0px;overflow:auto;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="background:transparent;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;text-align:left;vertical-align:baseline;padding:8px;font-family:Monaco, Menlo, 'Courier New', monospace;display:block;line-height:20px;color:rgb(173, 255, 47);overflow:auto;background-color:rgb(57, 57, 57);border-radius:0px 0.71em 0.71em 0px;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">rdd</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">{</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">x</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">conn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">getDBConn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">conn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">write</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">x</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">toString</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">);</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">conn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">close</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">}</span>
</pre></div>
</td></tr></tbody></table></div>
<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">改为：</p>
<div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><table style="outline:0px;font-size:100%;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;border:0px;font-weight:inherit;text-align:left;vertical-align:baseline;background:transparent;border-collapse:collapse;border-spacing:0px;width:100%;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><td style="text-align:left;margin:0px;border:0px;outline:0px;font-size:100%;padding:0px;vertical-align:baseline;background:transparent;overflow:auto;width:35px;border-right-width:0px;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="font-family:Monaco, Menlo, 'Courier New', monospace;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;background-color:rgb(57, 57, 57);vertical-align:baseline;background:transparent;padding:8px;display:block;line-height:20px;overflow:auto;border-radius:0.71em 0px 0px 0.71em;color:rgb(190, 190, 197);text-align:right;border-right-style:none;">1</pre></div></td><td style="margin:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;padding:0px;overflow:auto;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="background:transparent;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;text-align:left;vertical-align:baseline;padding:8px;font-family:Monaco, Menlo, 'Courier New', monospace;display:block;line-height:20px;color:rgb(173, 255, 47);overflow:auto;background-color:rgb(57, 57, 57);border-radius:0px 0.71em 0.71em 0px;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">rdd</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">mapPartitions</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">records</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">conn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">getDBConn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">for</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">item</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">&lt;-</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">records</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">write</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">item</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">toString</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">);</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">conn</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">close</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
</pre></div>
</td></tr></tbody></table></div>
<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">RDD操作:使用coalesce减小空运行的任务数量</h3>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">性能优化点</h4>

<ul style="margin:0px 0px 10px 25px;padding:0px;border:0px;outline:0px;font-size:14px;text-align:left;vertical-align:baseline;background:transparent;list-style:disc;">
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">场景一</li>
</ul>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">当对RDD进行多次过滤时，可能会形成很多空的、无数据的Partition。通过调用coalesce方法，可以减小Task个数。让有的Task可以同时管理多个Partition。</p>

<ul style="margin:0px 0px 10px 25px;padding:0px;border:0px;outline:0px;font-size:14px;text-align:left;vertical-align:baseline;background:transparent;list-style:disc;">
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">场景二</li>
</ul>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">当任务数过多的时候，Shuffle压力太大导致程序挂住不动，或者出现linux资源受限的问题。此时，可以通过调用coalesce方法，可以减小Task个数，让程序得以继续运行。</p>

<blockquote style="vertical-align:baseline;margin:0px 0px 15px;border:0px;outline:0px;font-size:100%;text-align:left;padding:0px 0px 0px 14px;background:transparent;quotes:none;border-left-width:5px;border-left-style:solid;border-left-color:rgb(238, 238, 238);"><span style="font-size:100%;text-align:left;quotes:none;"></span>
<p style="vertical-align:baseline;margin:0px 0px 14px;border:0px;outline:0px;background:transparent;text-align:left;padding:0px;font-size:14px;line-height:34px;color:rgb(119, 119, 119);margin-bottom:0px;font-weight:300;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">coalesce()方法接受一个参数，为减小后的目标Partition个数。</p>
<span style="font-size:100%;text-align:left;quotes:none;"></span></blockquote>

<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">RDD操作:collect</h3>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">Collect操作会将Executor的数据发送的Driver端。需要确保Driver有足够的内存。Driver的内存通过参数spark.driver.memory参数进行配置。</p>

<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">RDD操作:使用reduceByKey替代groupByKey</h3>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">reduceByKey会在Map端做本地聚合，而groupByKey等Shuffle操作不会再Map端做聚合。
能使用reduceByKey的地方尽量使用该方式，避免出现.groupByKey().map(x=&gt;(x.<em style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;font-style:italic;">1,x.</em>2.size))</p>

<ul style="margin:0px 0px 10px 25px;padding:0px;border:0px;outline:0px;font-size:14px;text-align:left;vertical-align:baseline;background:transparent;list-style:disc;">
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">举例</li>
</ul>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">对于数据</p>
<pre style="background:transparent;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;text-align:left;vertical-align:baseline;padding:8px;font-family:Monaco, Menlo, 'Courier New', monospace;display:block;line-height:20px;border-radius:4px;overflow:auto;color:rgb(173, 255, 47);background-color:rgb(57, 57, 57);"><code style="text-align:left;margin:0px;border:0px;outline:0px;font-size:12px;padding:0px;vertical-align:baseline;background:transparent;font-family:Monaco, Menlo, 'Courier New', monospace;color:rgb(238, 238, 238);border-radius:3px;">2015-05-01 13:00:00,B101,MEILIN
2015-05-01 10:04:20,B101,GUANLAN
2015-05-01 09:18:00,F301,MEILIN
2015-05-01 12:00:00,B107,WUHE
2015-05-01 18:20:00,F301,WUHE
2015-05-02 12:00:02,T442,GUANLAN
2015-05-01 07:00:00,B101,GUANLAN
2015-05-01 21:31:00,M721,WUHE
2015-05-01 09:00:00,Z007,MEILIN</code></pre>
<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">现在要统计各个车牌(第二列)出现的次数，则应使用：</p>
<div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><table style="outline:0px;font-size:100%;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;border:0px;font-weight:inherit;text-align:left;vertical-align:baseline;background:transparent;border-collapse:collapse;border-spacing:0px;width:100%;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><td style="text-align:left;margin:0px;border:0px;outline:0px;font-size:100%;padding:0px;vertical-align:baseline;background:transparent;overflow:auto;width:35px;border-right-width:0px;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="font-family:Monaco, Menlo, 'Courier New', monospace;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;background-color:rgb(57, 57, 57);vertical-align:baseline;background:transparent;padding:8px;display:block;line-height:20px;overflow:auto;border-radius:0.71em 0px 0px 0.71em;color:rgb(190, 190, 197);text-align:right;border-right-style:none;">1
2
3
4
5</pre></div></td><td style="margin:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;padding:0px;overflow:auto;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="background:transparent;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;text-align:left;vertical-align:baseline;padding:8px;font-family:Monaco, Menlo, 'Courier New', monospace;display:block;line-height:20px;color:rgb(173, 255, 47);overflow:auto;background-color:rgb(57, 57, 57);border-radius:0px 0.71em 0.71em 0px;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">dataRDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">sc</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">textFile</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(230, 219, 116);">&quot;file:///tmp/data.txt&quot;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data2RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">dataRDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">s</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">s</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">split</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(230, 219, 116);">&quot;,&quot;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">))</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data3RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data2RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(174, 129, 255);">1</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">),</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(174, 129, 255);">1</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data4RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data3RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">reduceByKey</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">_</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">+</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">_</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data4RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">collect</span>
</pre></div>
</td></tr></tbody></table></div>
<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">而不是：</p>
<div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><table style="outline:0px;font-size:100%;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;border:0px;font-weight:inherit;text-align:left;vertical-align:baseline;background:transparent;border-collapse:collapse;border-spacing:0px;width:100%;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><td style="text-align:left;margin:0px;border:0px;outline:0px;font-size:100%;padding:0px;vertical-align:baseline;background:transparent;overflow:auto;width:35px;border-right-width:0px;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="font-family:Monaco, Menlo, 'Courier New', monospace;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;background-color:rgb(57, 57, 57);vertical-align:baseline;background:transparent;padding:8px;display:block;line-height:20px;overflow:auto;border-radius:0.71em 0px 0px 0.71em;color:rgb(190, 190, 197);text-align:right;border-right-style:none;">1
2
3
4
5
6</pre></div></td><td style="margin:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;padding:0px;overflow:auto;"><div style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;"><pre style="background:transparent;margin:0px 0px 15px;border:1px solid rgb(225, 225, 232);outline:0px;font-size:12px;text-align:left;vertical-align:baseline;padding:8px;font-family:Monaco, Menlo, 'Courier New', monospace;display:block;line-height:20px;color:rgb(173, 255, 47);overflow:auto;background-color:rgb(57, 57, 57);border-radius:0px 0.71em 0.71em 0px;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">dataRDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">sc</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">textFile</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(230, 219, 116);">&quot;file:///tmp/data.txt&quot;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data2RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">dataRDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">s</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">s</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">split</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(230, 219, 116);">&quot;,&quot;</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">))</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data3RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data2RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(174, 129, 255);">1</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">),</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(166, 226, 46);">Array</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(174, 129, 255);">0</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">),</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">a</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(174, 129, 255);">2</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)))</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">)</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data4RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data3RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">groupByKey</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">()</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">var</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data5RDD</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data4RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">map</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">x</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(102, 217, 239);">=&gt;</span> <span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">(</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">x</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">_1</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">,</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">x</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">_2</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">size</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">))</span>
<span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">data5RDD</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(249, 38, 114);">.</span><span style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;color:rgb(248, 248, 242);">collect</span>
</pre></div>
</td></tr></tbody></table></div>
<h3 style="vertical-align:baseline;margin:20px -20px;border:0px;outline:0px;font-size:20px;text-align:left;padding:0px 20px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:35px;background-color:rgb(242, 248, 247);">避免数据倾斜</h3>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">如何检测数据倾斜？</h4>

<p style="text-align:left;margin:0px 0px 14px;border:0px;outline:0px;font-size:15px;padding:0px;vertical-align:baseline;background:transparent;line-height:30px;color:rgb(85, 85, 85);font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">现象：没有GC，各Task执行时间严重不一致。</p>

<h4 style="vertical-align:baseline;margin:20px 0px;border:0px;outline:0px;font-size:16px;text-align:left;padding:0px 5px;background:transparent;font-weight:normal;text-rendering:optimizeLegibility;color:rgb(119, 119, 119);line-height:28px;background-color:rgb(242, 248, 247);">性能优化点</h4>

<ul style="margin:0px 0px 10px 25px;padding:0px;border:0px;outline:0px;font-size:14px;text-align:left;vertical-align:baseline;background:transparent;list-style:disc;">
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">重新设计key，以更小粒度的key使得Task大小合理化。</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-size:100%;text-align:left;vertical-align:baseline;background:transparent;line-height:32px;font-family:宋体, Quantico, 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, 微软雅黑, sans-serif;">有时提升并行度，有助于解决数据倾斜</li>
</ul>

</div></div></div></div></div></div></div><br/></span>
</div></body></html> 